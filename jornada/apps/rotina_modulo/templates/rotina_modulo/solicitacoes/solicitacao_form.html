{% extends "rotina_modulo/base.html" %}
{% load shared_components %}


{% block body %}

{% Form form=form enctype="multipart/form-data" %}

  {% if form.instance.alteracao_solicitada %}
    <div class="row">
      <div class="col-12 py-1 text-danger text-align-center">   
              Alteração Solicitada: <small>{{solicitacao.mensagem_alteracao}}</small>
      </div>
    </div>
  {% endif %}

<fieldset class="border rounded p-3 bg-light mb-3">
  
  <div class="row">
    <div class="col-md-6 py-1">
      {% LabeledInput field=form.adolescente %} {% /LabeledInput %}
    </div>
    <div class="col-md-6">
      {% LabeledInput field=form.acao_solicitada %}{% /LabeledInput %}
    </div>
  </div>
  
  <div class="row">
    <div class="col-12 py-1">
      {% LabeledInput field=form.observacoes %} {% /LabeledInput %}
    </div>
  </div>

</fieldset>


{% Fieldset legenda="Anexos" legenda_transparente="True" class="bg-light py-3 px-2"%}

  {% InlineFormset formset=anexos %}
    {% arg empty_form %}
      <div class="row justify-content-center px-0 mb-2 m-0">
        {{ anexos.empty_form.id }}

        <div class="col-lg-3 px-1 mt-auto mb-2">
          {% LabeledInput field=anexos.empty_form.anexo %}{% /LabeledInput %}
        </div>
    
        <div class="col-lg-3 px-1 mt-auto mb-2">
          {% LabeledInput field=anexos.empty_form.tipo_anexo %}{% /LabeledInput %}
        </div>
    
        <div class="col-lg-4 px-1 mt-auto mb-2">
          {% LabeledInput field=anexos.empty_form.descricao %}{% /LabeledInput %}
        </div>
    
        <div class="col-lg-2 px-1 mt-auto mb-2">
          {% LabeledInput field=anexos.empty_form.DELETE %}{% /LabeledInput %}
        </div>

        {{ anexos.empty_form.solicitacao }}
      </div>
    {% endarg %}
    
    {% for anexo in anexos %}
      {% FormErrors form=anexo %}{% /FormErrors %}
      <div class="row justify-content-center px-0 mb-2 m-0">
        {{ anexo.id }}

        <div class="col-lg-3 px-1 mt-auto mb-2">
          {% LabeledInput field=anexo.anexo %}{% /LabeledInput %}
        </div>
    
        <div class="col-lg-3 px-1 mt-auto mb-2">
          {% LabeledInput field=anexo.tipo_anexo %}{% /LabeledInput %}
        </div>
    
        <div class="col-lg-4 px-1 mt-auto mb-2">
          {% LabeledInput field=anexo.descricao %}{% /LabeledInput %}
        </div>
    
        <div class="col-lg-2 px-1 mt-auto mb-2">
          {% if anexo.instance.criado_por == request.user or not anexo.instance.pk %}
              {% LabeledInput field=anexo.DELETE %}{% /LabeledInput %}
          {% else %}
              <small class="fst-italic" style="color: #777474;"> criado por: {{anexo.instance.criado_por}} </small>
          {% endif %}
        </div>

        {{ anexo.solicitacao }}
      </div>
    {% endfor %}



  {% /InlineFormset%}

{% /Fieldset %}

{% arg botao_voltar %}
{% endarg%}

{% /Form %}



{% endblock %}


{% block js %}

<script>
  $("#id_adolescente").change(function () {
    
      var id_adolescente = $(this).val();  
      if(id_adolescente == "") {
        var selectbox = $('#id_processo');
        selectbox.find('option').remove();
        selectbox.append("<option value='' selected=''>---------</option>")
      }else{

          $.ajax({                       
            url: '/api/processos/?adolescente='+id_adolescente,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
            type: 'GET',
            dataType: 'json', // added data type
            success: function(data) {
              if (data != null) {
                var results = data['results']
                var selectbox = $('#id_processo');
                selectbox.find('option').remove();
                
                if (results.length > 0){
                  selectbox.append("<option value='' selected=''>Selecione o Processo</option>")
                }else{
                  selectbox.append("<option value='' selected=''>Nenhum Processo Encontrado</option>")
                }
    
                $.each(data['results'], function (i, d) {
                    $('<option>').val(d.id).text(d.str_sem_nome).appendTo(selectbox);
                });
            }
    
    
          }
        });
      }
     
  
    });

    $( document ).ready(function() {
      var selected = $('#id_processo selected');
      if(!selected){
        $('#id_adolescente').trigger('change');
      }
    });

</script>

{% endblock %}