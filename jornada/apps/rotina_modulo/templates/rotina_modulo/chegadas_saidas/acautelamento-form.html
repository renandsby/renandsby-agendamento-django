{% extends "rotina_modulo/base.html" %}
{% load shared_components %}


{% block body %}

<div class="row justify-content-center mt-4">
  {% Fieldset class="bg-light py-4 px-5 col-md-6" %}
  {% arg titulo %}
    <small>Realizar acautelamento de:</small> {{form.instance.adolescente.nome}}
  {% endarg %}
  <p>
    <small>
      {% if form.instance.observacoes_entrada %}
      "{{form.instance.observacoes_entrada}}" 
      {% endif %}
    </small>
  </p>
<form method="POST">
  {% csrf_token %}
 
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.data_entrada %}{% /LabeledInput %}
          </div>
        </div>
        
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.tipo_entrada %}{% /LabeledInput %}
          </div>
        </div>
        
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.tipo_vaga %}{% /LabeledInput %}
          </div>
        </div>
        
        
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.protetiva %}{% /LabeledInput %}
          </div>
        </div>
        
        {% if form.instance.unidade.modulos.count > 1 %}
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.modulo %}{% /LabeledInput %}
          </div>
        </div>
        {% endif %}

        {% if form.instance.unidade.modulos.first.quartos.exists %}
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.quarto %}{% /LabeledInput %}
          </div>
        </div>
        {% endif %}
        
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.especialista_referencia %}{% /LabeledInput %}
          </div>
        </div>

        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.agente_referencia %}{% /LabeledInput %}
          </div>
        </div>

      <div class="d-flex flex-start gap-2 my-3">
        <input type="submit" value="Realizar Acautelamento" class="btn btn-primary">
        
      </div>

</form>

{% /Fieldset %}

{% endblock %}







{% block js %}

{% comment %} https://www.jqueryscript.net/form/Bootstrap-4-Multi-Select-BsMultiSelect.html {% endcomment %}
<script>
  $(function(){
    $("#id_agente_referencia").bsMultiSelect();
    $("#id_especialista_referencia").bsMultiSelect();
  });

  $("#id_modulo").change(function () {

    var id_modulo = $(this).val();
    if (id_modulo == "") {
      var selectbox = $('#id_quarto');
      selectbox.find('option').remove();
      selectbox.append("<option value='' selected=''>---------</option>")
    } else {

      $.ajax({
        url: '/api/unidades/quarto/?modulo=' + id_modulo,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        type: 'GET',
        dataType: 'json', // added data type
        success: function (data) {
          if (data != null) {
            var results = data['results']
            var selectbox = $('#id_quarto');
            selectbox.find('option').remove();

            if (results.length > 0) {
              selectbox.append("<option value='' selected=''>Selecione o Quarto</option>")
            } else {
              selectbox.append("<option value='' selected=''>Nenhum Quarto Encontrado</option>")
            }

            $.each(data['results'], function (i, d) {
              var quarto = d.numero + d.nome
              
              $('<option>').val(d.id).text(quarto).appendTo(selectbox);
            });
          }


        }
      });
    }


  });

  $(document).ready(function () {
    var selected = $('#id_quarto selected');
    if (!selected) {
      $('#id_modulo').trigger('change');
    }
  });

</script>

{% endblock %}
