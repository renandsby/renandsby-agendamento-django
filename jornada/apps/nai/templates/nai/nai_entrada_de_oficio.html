{% extends "rotina_modulo/base.html" %}
{% load shared_components %}

{% block body %}

<div class="row justify-content-center mt-4">
  {% Fieldset class="bg-light py-4 px-5 col-md-6" %}
  {% arg titulo %}
    
  Acautelamento
  {% endarg %}
<form method="POST">
  {% csrf_token %}
  {{form.unidade}}
  {% if form.non_field_errors %} <div class="text-danger">{{form.non_field_errors}}</div> {% endif %}
  <div class="row">
    <div class="col-12 py-1 mb-2">
      {% LabeledInput field=form.data_entrada %}{% /LabeledInput %}
    </div>
  </div>
  <div class="row">
    <div class="col-12 py-1 mb-2">
      {% LabeledInput field=form.adolescente %}{% /LabeledInput %}
    </div>
  </div>
  <div class="row">
    <div class="col-12 py-1 mb-2">
      {% LabeledInput field=form.processo %}{% /LabeledInput %}
    </div>
  </div>
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.tipo_entrada %}{% /LabeledInput %}
          </div>
        </div>
        
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.tipo_vaga %}{% /LabeledInput %}
          </div>
        </div>
        
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.protetiva %}{% /LabeledInput %}
          </div>
        </div>
        
        {% if modulo.unidade.modulos.count > 1 %}
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.modulo|attrs:"required=true" %}{% /LabeledInput %}
          </div>
        </div>
        {% endif %}

        {% if modulo.unidade.modulos.first.quartos.exists %}
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.quarto|attrs:"required=true" %}{% /LabeledInput %}
            {{form.modulo}}
          </div>
        </div>
        {% endif %}
        
        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.especialista_referencia %}{% /LabeledInput %}
          </div>
        </div>

        <div class="row">
          <div class="col-12 py-1 mb-2">
            {% LabeledInput field=form.agente_referencia %}{% /LabeledInput %}
          </div>
        </div>

      <div class="d-flex flex-start gap-2 my-3">
        <input type="submit" value="Realizar Acautelamento" class="btn btn-primary">
        
      </div>


</form>

{% /Fieldset %}
{% endblock %}


{% block js %}

<script>
  $(function(){
    $("#id_agente_referencia").bsMultiSelect();
    $("#id_especialista_referencia").bsMultiSelect();
  });


  $("#id_adolescente").change(function () {
    
      var id_adolescente = $(this).val();  
      if(id_adolescente == "") {
        var selectbox = $('#id_processo');
        selectbox.find('option').remove();
        selectbox.append("<option value='' selected=''>---------</option>")
      }else{

          $.ajax({                       
            url: '/api/processos/?adolescente='+id_adolescente,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
            type: 'GET',
            dataType: 'json', // added data type
            success: function(data) {
              if (data != null) {
                var results = data['results']
                var selectbox = $('#id_processo');
                selectbox.find('option').remove();
                if (results.length > 0){
                  selectbox.append("<option value='' selected=''>Selecione o Processo</option>")
                }else{
                  selectbox.append("<option value='' selected=''>Nenhum Processo Encontrado</option>")
                }
                $.each(data['results'], function (i, d) {
                    $('<option>').val(d.id).text(d.str_sem_nome).appendTo(selectbox);
                });
            }
    
    
          }
        });
      }
     
  
    });

    $( document ).ready(function() {
      var selected = $('#id_processo selected');
      if(!selected){
        $('#id_adolescente').trigger('change');
      }
    });

</script>

{% endblock %}